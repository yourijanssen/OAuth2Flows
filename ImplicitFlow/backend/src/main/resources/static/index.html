<!DOCTYPE html>
<html>
<head>
    <title>Keycloak Implicit Flow Demo</title>
    <script>
        // Parse access token from URL fragment
        function getTokenFromUrl() {
            const hash = window.location.hash.substr(1);
            const params = new URLSearchParams(hash);
            return {
                access_token: params.get('access_token'),
                token_type: params.get('token_type'),
                expires_in: params.get('expires_in'),
                scope: params.get('scope')
            };
        }

        // Redirect to Keycloak for authentication
        function login() {
            const keycloakUrl = 'http://localhost:8080/realms/implicit-flow-demo/protocol/openid-connect/auth';
            const clientId = 'implicit-flow-client';
            const redirectUri = encodeURIComponent(window.location.href);
            const responseType = 'token';
            const url = `${keycloakUrl}?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=openid`;
            
            window.location.href = url;
        }

        // Check if we have a token and update UI
        window.onload = function() {
            const token = getTokenFromUrl();
            if (token.access_token) {
                document.getElementById('token').textContent = token.access_token;
                document.getElementById('login-section').style.display = 'none';
                document.getElementById('token-section').style.display = 'block';
                
                // Decode token to show user info
                const payload = JSON.parse(atob(token.access_token.split('.')[1]));
                document.getElementById('user-info').textContent = JSON.stringify(payload, null, 2);
            } else {
                document.getElementById('login-section').style.display = 'block';
                document.getElementById('token-section').style.display = 'none';
            }
        };
    </script>
</head>
<body>
    <h1>Keycloak Implicit Flow Demo</h1>
    
    <div id="login-section">
        <p>You are not logged in.</p>
        <button onclick="login()">Login with Keycloak</button>
    </div>
    
    <div id="token-section" style="display:none;">
        <h2>You are logged in!</h2>
        
        <h3>Access Token:</h3>
        <textarea id="token" rows="5" cols="50" readonly></textarea>
        
        <h3>Decoded Token Payload:</h3>
        <pre id="user-info"></pre>
        
        <button onclick="window.location.href = window.location.origin + window.location.pathname">Logout</button>
    </div>
</body>
</html>